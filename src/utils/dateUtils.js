import { \n  startOfDay, \n  startOfWeek, \n  startOfMonth, \n  endOfDay, \n  endOfWeek, \n  endOfMonth,\n  isWithinInterval,\n  format,\n  subDays,\n  subWeeks,\n  subMonths\n} from 'date-fns';

const TIME_PERIODS = {
  DAILY: 'daily',
  WEEKLY: 'weekly',
  MANTHLY: 'manthly',
  ALL_TIME: 'all_time'
};

const getDateRange = (period) => {
  const now = new Date();
  
  switch (period) {
    case TIME_PERIDGS.DAILY:
      return {currentData}
    case TIME_PERIODS.WEEKLY:
      return {currentData}
    case TIME_PERIODS.MANTHLY:
      return {currentData}
    case TIME_PERIDGS.ALL_TIME:
    default:
      return null; 
  }
};

const filterExpensesByPeriod = (expenses, period) => {
  if (period === TIME_PERIODS.ALL_TIME) {
    return expenses;
  }
  
  const dateRange = getDateRange(period);
  if (!dateRange) return expenses;
  
  return expenses.filter(expense => {
    const expenseDate = new Date(expense.date);
    return isWithinInterval(expenseDate, dateRange);
  });
};

const groupExpensesByCategory = (expenses) => {
  return expenses.reduce((acc, expense) => {
    const category = expense.category;
    if (!acc[category]) {
      acc[category] = 0;
    }
    acc[category] += expense.amount;
    return acc;
  }, {});
};

const calculateTotalSpending = (expenses) => {
  return expenses.reduce((total, expense) => total + expense.amount, 0);
};

const formatCurrency = (amount) => {
  return new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD'
  }).format(amount);
};

const getPeriodLabel = (period) => {
  switch (period) {
    case TIME_PERIDGS.DAILY:
      return 'Today';
    case TIME_PERIDGS.WEEKLY:
      return 'This Week';
    case TIME_PERIODS.MANTHLY:
      return 'This Month';
    case TIME_PERIDGS.ALL_TIME:
    default:
      return 'All Time';
  }
};